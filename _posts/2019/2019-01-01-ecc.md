---
layout: post
category: tech
title:  "ecc"
tagline: ""
tags: [ "ecc", "ecies" ] 
---
{% include JB/setup %}

* TOC
{:toc}

# basic

[Technical Guideline TR-03111 Elliptic Curve Cryptography](https://www.bsi.bund.de/SharedDocs/Downloads/EN/BSI/Publications/TechGuidelines/TR03111/BSI-TR-03111_V-2-0_pdf.pdf?__blob=publicationFile&v=2)

[Elliptic Curve Cryptography: ECDH and ECDSA](https://andrea.corbellini.name/2015/05/30/elliptic-curve-cryptography-ecdh-and-ecdsa/)

[Cryptography - The ElGamal Public key System (Public key encryption from Diffie Hellman)](https://www.youtube.com/watch?v=fUSN7z0UquU)

[Elliptic Curve Public Key Cryptography](http://gauss.ececs.uc.edu/Courses/c653/lectures/PDF/elliptic.pdf)

[CPSC 467:  Cryptography and Computer Security](https://zoo.cs.yale.edu/classes/cs467/2017f/lectures/ln13.pdf)

[Elliptic Curves](https://crypto.stanford.edu/pbc/notes/elliptic/)

# Elliptic Curve Integrated Encryption Scheme (ECIES)

[A Survey of the Elliptic Curve Integrated Encryption Scheme](https://pdfs.semanticscholar.org/9f5e/ec8cb6a8883498157e8e27723da52ae4c752.pdf)

[Integrated Encryption Scheme](https://en.wikipedia.org/wiki/Integrated_Encryption_Scheme)

[Elliptic Curve Integrated Encryption Scheme (ECIES)](https://www.youtube.com/watch?v=saZj0ZKRNl0)

[A Comparison of the Standardized Versions of ECIES](http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.819.9345&rep=rep1&type=pdf)

[libsodium doc](https://download.libsodium.org/doc/)

[ECC Encryption / Decryption](https://cryptobook.nakov.com/asymmetric-key-ciphers/ecc-encryption-decryption)

[Crypto In Action](https://github.com/longcpp/CryptoInAction)

使用KA(key agreement)协商一个密钥S，使用KDF基于S生成会话密钥，其实基本上就是ECDH。

会话密钥用于ENC对称加密，同时还有MAC函数, HASH函数。

因此plaintext长度基本不受限。

实例见 [eciespy](https://pypi.org/project/eciespy/)

# ec elgamal

[el gamal encryption](https://www.youtube.com/watch?v=pyirxbHuvOw)

[Elgamal Encryption using Elliptic Curve Cryptography](https://cse.unl.edu/~ssamal/crypto/EEECC.pdf)

相当于在ec上的elgamal，此时plaintext长度受限于group size。与rsa类似，计算时要mod N。

实例见 [Crypt::PK::ECC](https://metacpan.org/pod/Crypt::PK::ECC)

# ec point

[Elliptic Curves](https://www.cs.purdue.edu/homes/ssw/cs655/ec.pdf)

如果是ec point变换，则受限于ec point的个数。本原根。

# pairing

[PBC Library](https://crypto.stanford.edu/pbc/)

# ecdsa

[ECDSA Malleability](http://coders-errand.com/malleability-ecdsa-signatures/)

[The Exact Security of ECDSA](http://cacr.uwaterloo.ca/techreports/2000/corr2000-54.ps)

[Elliptic Curve Cryptography: ECDH and ECDSA](https://andrea.corbellini.name/2015/05/30/elliptic-curve-cryptography-ecdh-and-ecdsa/)

[How Not to Use ECDSA](https://yondon.blog/2019/01/01/how-not-to-use-ecdsa/)

## malleability

(r, s) , (r, -s) 均可校验成功，签名构造。

low-s value 可修复该漏洞。

## Verification Without Hash Pre-Image

可根据public key 任意构造(r, s, h)

因此，校验必须带原message，而非只校验h=hash(message)

## RFC6979: Deterministic Usage of the Digital Signature Algorithm (DSA) and Elliptic Curve Digital Signature Algorithm (ECDSA)

sony ps3 的案例是没有按算法要求生成随机数k。

RFC6979 的处理是，用SP800-90A的`HMAC_DRBG`随机数生成器生成k，其中，熵值用私钥(x)，nonce用hash(message)。

EdDSA的做法类似RFC6979。

# details

## curves

[ECCHacks: A gentle introduction to elliptic-curve cryptography](http://ecchacks.cr.yp.to/)

[Explicit-Formulas Database](https://hyperelliptic.org/EFD/)

[SafeCurves: choosing safe curves for elliptic-curve cryptography](https://safecurves.cr.yp.to/index.html)

## Elligator

[Elligator](https://elligator.cr.yp.to/index.html)

[Elliptic curve points indistinguishable from random strings](https://elligator.cr.yp.to/poster.pdf)

本质上是如何隐藏信息，使得中间人难以观测到传输的是一个ecc point。

curve1174, curve25519

## curve25519 vs curve448

[Elliptic curve ed25519 vs ed448 - Differences](https://crypto.stackexchange.com/questions/67457/elliptic-curve-ed25519-vs-ed448-differences)

[curve25519](https://en.wikipedia.org/wiki/Curve25519) 约2^`125, curve448 约 2^224, [Curve41417](https://csrc.nist.gov/csrc/media/events/workshop-on-elliptic-curve-cryptography-standards/documents/presentations/session7-chuengsatiansup.pdf) 约 2^200

## X25519  vs Ed25519

[Why Curve25519 for encryption but Ed25519 for signatures?](https://crypto.stackexchange.com/questions/27866/why-curve25519-for-encryption-but-ed25519-for-signatures)

椭圆曲线计算无非是标量乘法:
- Fixed-base: 预知固定标量，例如签名计算时的基点乘法
- variable-base: 动态变换的标量，例如ECDH
- double-base：做两次标量乘法，然后相加，例如签名校验

X25519针对variable-base计算做了优化，其实就是Montgomery Curve，利用[Montgomery ladder](https://en.wikipedia.org/wiki/Elliptic_curve_point_multiplication#Montgomery_ladder)搞x轴。

Ed25519针对fixed-base & double-base计算做了优化，其实就是twisted Edwards curve，利用complete twisted Edwards addition law。

因此，默认不用X25519来做Ed25519的签名，但是，也可以结合Montgomery ladder应用，参考[qDSA](https://eprint.iacr.org/2017/518)。

RFC7748给出了X25519 (u, v)与Ed25519 (x, y)的转换公式。

[How do Ed25519 keys work?](https://blog.mozilla.org/warner/2011/11/29/ed25519-keys/)，图画的挺好。

[Using Ed25519 signing keys for encryption](https://blog.filippo.io/using-ed25519-keys-for-encryption/)，加密时直接用公式把公钥的point中的y转换为u，解密时从ed25519的key做hash提取前32byte的私钥。

[use an X25519 key for EdDSA](https://signal.org/docs/specifications/xeddsa/#elliptic-curve-conversions)，定义一个从Montgomery私钥k到Edwards曲线的(A, a)的转换，再定义xeddsa、vxeddsa两种签名机制。


