---
layout: post
category : tech
title:  "QUIC : quick udp internet connections"
tagline: ""
tags : [ "network", "quic", "udp" ] 
---
{% include JB/setup %}

# 概要

[QUIC at 10,000 feet](https://docs.google.com/document/d/1gY9-YNDNAB1eip-RTPbqphgySwSNSDHLq9D5Bty4FSU/edit)

目的是用 udp + quic 取代 tcp+tls+spdy 的组合，优化点：

## 低连接时延

避免tcp + tls多次握手认证

首次通信 1-roundtrip handshake 认证，后续可以 0 roundtrip 复用

这个时延优化效果比较给力。但复用认证也需要弄一些安全措施加固。

## 拥塞控制

原始数据包 与 重传数据包 采用 独立的序列号，不复用。此时能够区分原始/重传ack，避免tcp拥塞反复重传。

ack还带上收包<->发出ack包的时间，提高roundtrip测量精度。

256 NACK range，相比于 TCP的SACK，对失序/丢包的容忍度更大。

[nak](https://books.google.com/books?id=9-kAI9-VwDsC&pg=PA297&lpg=PA297&dq=tcp+nak&source=bl&ots=BdWLiplmJu&sig=3uUmJyBeg4PX98X6VpkiJyEksp8&hl=zh-CN&sa=X&ei=fZw_VfD0LIeQyATcs4CoAw&ved=0CE4Q6AEwBg#v=onepage&q=tcp%20nak&f=false)

[sack](http://packetlife.net/blog/2010/jun/17/tcp-selective-acknowledgments-sack/)

反正是在udp上面嘛。。。

## 多路复用

spdy + tcp 能支持多个流，但是当tcp丢包时，就要傻等。

quic 基于 udp，某个流的udp丢包，其他流不受影响。

这个是继承udp的好处。

## 前向校验

开启FEC (forward error correction)选项，一组数据包即使有部分丢包，也可以通过FEC重组（不需重传）。

FEC选项由发送方决定是否开启。

这个选项明显消耗更多资源，我觉得有没有人愿意用很难说。除非是网络质量比较差的时候再开。。。

## 连接迁移

以client随机生成的64 bit连接ID进行标识，而不像传统的 srcip, srcport,dstip, dstport 四元组。

client换ip也可以复用之前的connection id，不用重新起连接。

这个还是N年的老问题，ip地址某种程度上存在 身份+寻址 复合作用，这里用连接ID硬拆开些。
